<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> <title>Crypto Miner Tycoon - Landscape</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Pastikan body mengambil seluruh tinggi viewport, penting untuk layout flex */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden; /* Mencegah scroll di body utama */
            font-family: 'Inter', sans-serif;
        }
        body {
            display: flex;
            flex-direction: column; /* Header di atas, konten di bawah */
        }
        /* Kontainer utama untuk layout landscape (3D view | Panel Kanan) */
        #main-content-wrapper {
            display: flex;
            flex-direction: row; /* Konten 3D dan panel kanan berdampingan */
            flex-grow: 1; /* Ambil sisa tinggi setelah header */
            height: calc(100% - 64px); /* Sesuaikan jika tinggi header berbeda */
            overflow: hidden; /* Mencegah scroll */
        }
        #left-panel {
            flex-grow: 1; /* Area 3D mengambil sisa ruang */
            height: 100%;
            position: relative; /* Agar canvas bisa absolut di dalamnya jika perlu */
            overflow: hidden; /* Mencegah overflow internal */
        }
        #canvas-container {
            width: 100%;
            height: 100%;
            background-color: #4a5568; /* bg-gray-700 */
        }
        #right-panel {
            width: 300px; /* Lebar tetap untuk panel kanan */
            height: 100%;
            display: flex;
            flex-direction: column;
            background-color: #2d3748; /* bg-gray-800 */
            padding: 1rem; /* padding 4 */
            overflow-y: auto; /* Scroll jika konten melebihi tinggi */
            border-left: 1px solid #4a5568; /* Garis pemisah */
        }
        /* Styling tambahan untuk tombol dan area log di panel kanan */
        #right-panel button:disabled { opacity: 0.5; cursor: not-allowed; }
        #log-area { font-size: 0.875rem; /* text-sm */ }

        /* Hide scrollbar for Chrome, Safari and Opera */
        #right-panel::-webkit-scrollbar { display: none; }
        /* Hide scrollbar for IE, Edge and Firefox */
        #right-panel { -ms-overflow-style: none; scrollbar-width: none; }

    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-900 text-gray-100">

    <header class="bg-gray-800 p-3 shadow-md flex justify-around items-center h-16" style="flex-shrink: 0;">
        <div class="text-center">
            <span class="text-xs text-gray-400 block">üí∞ Uang Virtual</span>
            <span id="uang-virtual" class="font-bold text-lg text-yellow-400">0</span>
        </div>
        <div class="text-center">
            <span class="text-xs text-gray-400 block"> unprocessed</span> <span id="mined-btc" class="font-bold text-lg text-orange-400">0.0000</span> <span class="text-xs">BTC</span> </div>
        <div class="text-center">
            <span class="text-xs text-gray-400 block">‚ö° Hashrate</span>
            <span id="total-hashrate" class="font-bold text-lg">0</span> <span class="text-xs">H/s</span>
        </div>
         <div class="text-center">
            <span class="text-xs text-gray-400 block">üå°Ô∏è Suhu CPU</span>
            <span id="suhu-cpu" class="font-bold text-lg">25</span> <span class="text-xs">¬∞C</span>
        </div>
        <div id="throttling-status" class="text-center text-red-500 font-medium text-xs" style="display: none;">
            üî• OVERHEAT!
        </div>
    </header>

    <div id="main-content-wrapper">

        <div id="left-panel">
            <div id="canvas-container">
                <div id="loading-indicator" style="position:absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #cbd5e0;">
                    Memuat Adegan 3D...
                </div>
            </div>
        </div>

        <aside id="right-panel">
            <section id="exchange-section" class="mb-6 p-3 bg-gray-700 rounded-lg shadow">
                <h3 class="text-md font-semibold mb-2 text-teal-300">Exchange BTC</h3>
                <div class="text-sm mb-2">
                    <span>Rate: 1 BTC = $</span><span id="exchange-rate" class="font-semibold text-yellow-300">50000</span>
                </div>
                <div class="mb-3">
                    <span class="text-sm text-gray-300">Belum ditukar: </span>
                    <span id="exchange-available-btc" class="font-bold text-orange-400">0.0000</span> <span class="text-xs">BTC</span>
                </div>
                <button id="exchange-button" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold p-2 rounded-lg shadow text-sm transition duration-150 ease-in-out disabled:bg-gray-500">
                    Tukar Semua BTC
                </button>
            </section>

            <section id="upgrade-section" class="mb-6 p-3 bg-gray-700 rounded-lg shadow">
                <h3 class="text-md font-semibold mb-3 text-teal-300">Upgrade Komponen</h3>
                <div class="flex flex-col space-y-3">
                    <button id="upgrade-cpu" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold p-2 rounded-lg shadow text-sm transition duration-150 ease-in-out disabled:bg-gray-500">
                        CPU (Lvl <span id="level-cpu">1</span>) - $ <span id="biaya-cpu">100</span>
                    </button>
                    <button id="upgrade-gpu" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold p-2 rounded-lg shadow text-sm transition duration-150 ease-in-out disabled:bg-gray-500">
                        GPU (Lvl <span id="level-gpu">1</span>) - $ <span id="biaya-gpu">150</span>
                    </button>
                    <button id="upgrade-pendingin" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold p-2 rounded-lg shadow text-sm transition duration-150 ease-in-out disabled:bg-gray-500">
                        Pendingin (Lvl <span id="level-pendingin">1</span>) - $ <span id="biaya-pendingin">80</span>
                    </button>
                </div>
            </section>

            <section id="log-section" class="flex-grow flex flex-col p-3 bg-gray-700 rounded-lg shadow overflow-hidden">
                <h3 class="text-md font-semibold mb-2 text-teal-300 flex-shrink-0">Log Aktivitas</h3>
                <div id="log-area" class="flex-grow overflow-y-auto text-xs space-y-1 text-gray-300">
                    <p>Selamat datang! Mulai mining...</p>
                </div>
            </section>
        </aside>

    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        // ==========================================
        // STATE GAME & KONFIGURASI
        // ==========================================
        const gameState = {
            uangVirtual: 100,
            minedBTC: 0, // BTC yang sudah ditambang tapi belum ditukar
            btcExchangeRate: 50000, // Contoh rate: 1 BTC = $50000
            komponen: {
                cpu: { level: 1, suhu: 25 },
                gpu: { level: 1, suhu: 25 },
                pendingin: { level: 1 },
                psu: { level: 1 }
            },
            maxTemp: 85,
            isThrottling: false,
            pendinginEffectiveness: 1,
            suhuAmbient: 25,
            hashToBtcRate: 0.000001 // Contoh: 1 H/s menghasilkan 0.000001 BTC per detik
        };

        const tiers = { // Data komponen per level (hashrate, power, heat)
            cpu: [{ level: 1, hashrate: 10, power: 50, heat: 5 }, { level: 2, hashrate: 25, power: 70, heat: 8 }, { level: 3, hashrate: 60, power: 100, heat: 12 }],
            gpu: [{ level: 1, hashrate: 20, power: 100, heat: 15 }, { level: 2, hashrate: 50, power: 150, heat: 25 }, { level: 3, hashrate: 120, power: 220, heat: 40 }],
            pendingin: [{ level: 1, dissipation: 1.0 }, { level: 2, dissipation: 1.5 }, { level: 3, dissipation: 2.2 }],
            psu: [{ level: 1, maxPower: 300 }, { level: 2, maxPower: 500 }]
        };

        const hargaUpgrade = { // Biaya upgrade awal dan multiplier
            cpu: { baseCost: 100, multiplier: 1.8 },
            gpu: { baseCost: 150, multiplier: 2.0 },
            pendingin: { baseCost: 80, multiplier: 1.6 }
        };

        // Fungsi helper
        function getCurrentTier(namaKomponen) { /* ... (sama seperti sebelumnya) ... */
            const level = gameState.komponen[namaKomponen].level;
            const tierData = tiers[namaKomponen].find(t => t.level === level);
            return tierData || tiers[namaKomponen][tiers[namaKomponen].length - 1];
         }
        function getNextUpgradeCost(namaKomponen) { /* ... (sama seperti sebelumnya) ... */
            const levelSaatIni = gameState.komponen[namaKomponen].level;
            const config = hargaUpgrade[namaKomponen];
            return Math.ceil(config.baseCost * Math.pow(config.multiplier, levelSaatIni -1));
        }

        // Variabel global Three.js
        let scene, camera, renderer, controls;
        let models = {}; // Menyimpan referensi mesh komponen rig
        let environmentModels = {}; // Menyimpan referensi mesh lingkungan (meja, kursi, dll)
        let aspect, frustumSize = 20; // Sesuaikan untuk zoom awal dengan scene baru yang lebih besar

        // Posisi relatif rig di atas meja
        const rigBasePosition = new THREE.Vector3(0, 0.8, 0); // X, Y (di atas meja), Z

        // ==========================================
        // FUNGSI INTI GAME
        // ==========================================
        function init() {
            console.log("Memulai inisialisasi game (Landscape)...");
            setupThreeJS();
            createEnvironmentModels(); // Buat meja, kursi, dll dulu
            createInitialModels(); // Buat rig di atas meja
            updateUI();
            setInterval(updateGameState, 1000);
            animate();
            setupEventListeners();
            addLogMessage("Game dimuat. Mode Landscape Aktif. Mulai mining BTC!");
            console.log("Inisialisasi selesai.");
        }

        function updateGameState() {
            const cpuTier = getCurrentTier('cpu');
            const gpuTier = getCurrentTier('gpu');
            const pendinginTier = getCurrentTier('pendingin');
            let totalHashrate = cpuTier.hashrate + gpuTier.hashrate;
            const totalPower = cpuTier.power + gpuTier.power;
            const heatGenerated = cpuTier.heat + gpuTier.heat;
            const heatDissipated = (gameState.komponen.cpu.suhu - gameState.suhuAmbient) * pendinginTier.dissipation * gameState.pendinginEffectiveness;
            const deltaSuhu = heatGenerated - heatDissipated;
            gameState.komponen.cpu.suhu += deltaSuhu * 0.05;
            gameState.komponen.cpu.suhu = Math.max(gameState.suhuAmbient, gameState.komponen.cpu.suhu);

            // Logika Throttling
            const throttlingElement = document.getElementById('throttling-status');
            if (gameState.komponen.cpu.suhu > gameState.maxTemp) {
                const overheatFactor = (gameState.komponen.cpu.suhu - gameState.maxTemp) / 10;
                const throttleMultiplier = Math.max(0.1, 1 - overheatFactor);
                totalHashrate *= throttleMultiplier;
                gameState.isThrottling = true;
                if (throttlingElement) throttlingElement.style.display = 'block';
            } else {
                gameState.isThrottling = false;
                 if (throttlingElement) throttlingElement.style.display = 'none';
            }

            // --- Perubahan Utama: Hitung BTC, bukan langsung Uang ---
            const btcMinedPerSecond = totalHashrate * gameState.hashToBtcRate;
            gameState.minedBTC += btcMinedPerSecond;
            // gameState.uangVirtual += profitPerDetik; // Hapus baris ini

            updateUI(totalHashrate, totalPower); // Kirim hashrate & power ke UI
        }

        /**
         * Menukarkan sejumlah BTC menjadi Uang Virtual.
         * @param {number} amountToExchange - Jumlah BTC yang ingin ditukar.
         */
        function exchangeBTC(amountToExchange) {
            if (amountToExchange <= 0 || isNaN(amountToExchange)) {
                addLogMessage("Jumlah BTC untuk ditukar tidak valid.", 'error');
                return;
            }
            if (amountToExchange > gameState.minedBTC) {
                 addLogMessage("BTC yang dimiliki tidak cukup untuk ditukar.", 'error');
                 return;
            }

            const uangGained = amountToExchange * gameState.btcExchangeRate;
            gameState.minedBTC -= amountToExchange;
            gameState.uangVirtual += uangGained;

            addLogMessage(`Berhasil menukar ${amountToExchange.toFixed(8)} BTC menjadi $${uangGained.toFixed(2)}`, 'success');
            console.log(`Exchanged ${amountToExchange} BTC for ${uangGained} Uang Virtual.`);

            updateUI(); // Perbarui tampilan UI setelah exchange
        }


        function upgradeComponent(namaKomponen) {
            // ... (Logika upgrade sama seperti sebelumnya, cek uang, level up, update 3D)
            const biayaUpgrade = getNextUpgradeCost(namaKomponen);
            const nextLevel = gameState.komponen[namaKomponen].level + 1;
            const maxLevel = tiers[namaKomponen].length;

            if (nextLevel > maxLevel) { /* ... Pesan Max Level ... */ addLogMessage(`Komponen ${namaKomponen.toUpperCase()} sudah mencapai level maksimum!`, 'warning'); return; }
            if (gameState.uangVirtual >= biayaUpgrade) {
                gameState.uangVirtual -= biayaUpgrade;
                gameState.komponen[namaKomponen].level = nextLevel;
                if (namaKomponen === 'pendingin') { gameState.pendinginEffectiveness = getCurrentTier('pendingin').dissipation; }
                updateComponentModel3D(namaKomponen, nextLevel); // Panggil update 3D
                addLogMessage(`Upgrade ${namaKomponen.toUpperCase()} ke Lvl ${nextLevel} berhasil! (-$${biayaUpgrade.toFixed(0)})`, 'success');
                updateUI();
            } else { /* ... Pesan Uang Kurang ... */ addLogMessage(`Uang tidak cukup untuk upgrade ${namaKomponen.toUpperCase()}. Butuh $${biayaUpgrade.toFixed(0)}.`, 'error'); }
        }

        function updateUI(currentHashrate, currentPower) {
            // Update Header Stats
            document.getElementById('uang-virtual').textContent = gameState.uangVirtual.toFixed(2);
            document.getElementById('mined-btc').textContent = gameState.minedBTC.toFixed(8); // Tampilkan 8 desimal untuk BTC
            document.getElementById('total-hashrate').textContent = (currentHashrate !== undefined ? currentHashrate : (getCurrentTier('cpu').hashrate + getCurrentTier('gpu').hashrate)).toFixed(1);
            document.getElementById('suhu-cpu').textContent = gameState.komponen.cpu.suhu.toFixed(1);

            // Update Panel Kanan - Exchange
            document.getElementById('exchange-rate').textContent = gameState.btcExchangeRate.toLocaleString(); // Format angka rate
            document.getElementById('exchange-available-btc').textContent = gameState.minedBTC.toFixed(8);
            document.getElementById('exchange-button').disabled = gameState.minedBTC <= 0; // Nonaktifkan jika tidak ada BTC

            // Update Panel Kanan - Tombol Upgrade
            ['cpu', 'gpu', 'pendingin'].forEach(comp => {
                const level = gameState.komponen[comp].level;
                const maxLevel = tiers[comp].length;
                const btn = document.getElementById(`upgrade-${comp}`);
                const levelSpan = document.getElementById(`level-${comp}`);
                const biayaSpan = document.getElementById(`biaya-${comp}`);

                levelSpan.textContent = level;
                if (level < maxLevel) {
                    const biaya = getNextUpgradeCost(comp);
                    biayaSpan.textContent = biaya.toFixed(0);
                    btn.disabled = gameState.uangVirtual < biaya;
                    // Update teks tombol (lebih ringkas)
                    btn.childNodes[0].nodeValue = `${comp.toUpperCase()} (Lvl ${level}) - $`; // Nama komponen (LEVEL) - $
                } else {
                    biayaSpan.textContent = "MAX";
                    btn.disabled = true;
                    btn.childNodes[0].nodeValue = `${comp.toUpperCase()} (MAX) - $`; // Nama komponen (MAX) - $
                }
            });
        }

        function addLogMessage(message, type = 'info') {
            // ... (Fungsi log sama seperti sebelumnya) ...
             const logArea = document.getElementById('log-area');
            if (!logArea) return; // Cek jika log area ada
            const newMessage = document.createElement('p');
            newMessage.textContent = message;
            switch (type) {
                case 'success': newMessage.className = 'text-green-400'; break;
                case 'warning': newMessage.className = 'text-yellow-400'; break;
                case 'error': newMessage.className = 'text-red-400'; break;
                default: newMessage.className = 'text-gray-300';
            }
            logArea.appendChild(newMessage);
            logArea.scrollTop = logArea.scrollHeight;
            const maxLogs = 30; // Tambah kapasitas log
            if (logArea.children.length > maxLogs) {
                logArea.removeChild(logArea.firstChild);
            }
        }

        // ==========================================
        // FUNGSI THREE.JS (Scene, Kamera, Model)
        // ==========================================
        function setupThreeJS() {
            const container = document.getElementById('canvas-container');
            if (!container) return;

            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x4a5568); // bg-gray-700

            aspect = container.clientWidth / container.clientHeight;
            frustumSize = 20; // Mungkin perlu lebih besar karena ada meja+kursi
            camera = new THREE.OrthographicCamera(frustumSize * aspect / -2, frustumSize * aspect / 2, frustumSize / 2, frustumSize / -2, 1, 1000);
            const camDistance = 18; // Jarak kamera mungkin perlu disesuaikan
            camera.position.set(camDistance * 0.8, camDistance * 0.7, camDistance); // Sesuaikan sudut sedikit
            // Fokus kamera sedikit lebih tinggi dan ke belakang dari meja
            const lookAtPosition = new THREE.Vector3(0, 1.5, -1);
            camera.lookAt(lookAtPosition);
            camera.updateProjectionMatrix();

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);
            const loadingIndicator = document.getElementById('loading-indicator');
            if (loadingIndicator) loadingIndicator.remove();

            // Pencahayaan
            const ambientLight = new THREE.AmbientLight(0xcccccc, 0.8);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.0);
            directionalLight.position.set(15, 20, 10); // Arah cahaya utama
            directionalLight.target.position.copy(lookAtPosition); // Targetkan cahaya ke titik fokus
            scene.add(directionalLight);
            scene.add(directionalLight.target); // Target harus di scene agar lookAt bekerja

            // Kontrol
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.1;
            // controls.enableRotate = false; // Tetap biarkan bisa rotasi untuk melihat-lihat
            controls.screenSpacePanning = true;
            controls.target.copy(lookAtPosition);
            controls.maxPolarAngle = Math.PI / 1.8; // Batasi sudut lihat ke bawah
            controls.minZoom = 0.5; // Batas zoom out orthographic
            controls.maxZoom = 3;   // Batas zoom in orthographic
            controls.update();

            window.addEventListener('resize', onWindowResize, false);
        }

        /**
         * Membuat model 3D untuk lingkungan (meja, kursi, monitor, karakter placeholder).
         */
        function createEnvironmentModels() {
            const deskHeight = 0.8;
            const deskWidth = 4;
            const deskDepth = 2;

            // Meja (coklat)
            const deskGeo = new THREE.BoxGeometry(deskWidth, deskHeight, deskDepth);
            const deskMat = new THREE.MeshStandardMaterial({ color: 0x8B4513, roughness: 0.8 }); // SaddleBrown
            const desk = new THREE.Mesh(deskGeo, deskMat);
            desk.position.y = deskHeight / 2; // Dasar meja di Y=0
            scene.add(desk);
            environmentModels['desk'] = desk;

             // Kursi (abu-abu gelap)
            const chairSeatGeo = new THREE.BoxGeometry(1, 0.2, 1);
            const chairBackGeo = new THREE.BoxGeometry(1, 1.2, 0.2);
            const chairMat = new THREE.MeshStandardMaterial({ color: 0x404040, roughness: 0.7 });
            const chairSeat = new THREE.Mesh(chairSeatGeo, chairMat);
            const chairBack = new THREE.Mesh(chairBackGeo, chairMat);
            chairSeat.position.set(0, deskHeight * 0.6, deskDepth / 2 + 0.6); // Depan meja, sedikit ke belakang
            chairBack.position.set(0, chairSeat.position.y + 1.2 / 2, chairSeat.position.z + 1 / 2 - 0.2 / 2); // Belakang & atas dudukan
            scene.add(chairSeat);
            scene.add(chairBack);
            environmentModels['chairSeat'] = chairSeat;
            environmentModels['chairBack'] = chairBack;

            // Karakter Placeholder (biru muda)
            const charBodyGeo = new THREE.BoxGeometry(0.6, 0.9, 0.5);
            const charHeadGeo = new THREE.SphereGeometry(0.3, 16, 16);
            const charMat = new THREE.MeshStandardMaterial({ color: 0xADD8E6 }); // LightBlue
            const charBody = new THREE.Mesh(charBodyGeo, charMat);
            const charHead = new THREE.Mesh(charHeadGeo, charMat);
            // Posisikan badan di atas kursi
            charBody.position.set(chairSeat.position.x, chairSeat.position.y + 0.2/2 + 0.9/2, chairSeat.position.z);
            // Posisikan kepala di atas badan
            charHead.position.set(charBody.position.x, charBody.position.y + 0.9/2 + 0.3, charBody.position.z);
            scene.add(charBody);
            scene.add(charHead);
            environmentModels['characterBody'] = charBody;
            environmentModels['characterHead'] = charHead;

            // Monitor Placeholder (hitam)
            const monitorScreenGeo = new THREE.BoxGeometry(1.5, 0.9, 0.1);
            const monitorStandGeo = new THREE.BoxGeometry(0.3, 0.2, 0.3);
            const monitorMat = new THREE.MeshStandardMaterial({ color: 0x1a1a1a, roughness: 0.2 });
            const monitorScreen = new THREE.Mesh(monitorScreenGeo, monitorMat);
            const monitorStand = new THREE.Mesh(monitorStandGeo, monitorMat);
            // Stand di atas meja
            monitorStand.position.set(0, deskHeight + 0.2/2, -deskDepth / 2 + 0.5);
            // Layar di atas stand
            monitorScreen.position.set(monitorStand.position.x, monitorStand.position.y + 0.2/2 + 0.9/2, monitorStand.position.z);
            scene.add(monitorStand);
            scene.add(monitorScreen);
            environmentModels['monitorScreen'] = monitorScreen;
            environmentModels['monitorStand'] = monitorStand;

             // Update rigBasePosition Y agar sesuai tinggi meja
             rigBasePosition.y = deskHeight;
        }


        /**
         * Membuat model 3D awal untuk komponen rig di atas meja.
         */
        function createInitialModels() {
            // Motherboard (alas rig) di atas meja
            const moboGeo = new THREE.BoxGeometry(1.5, 0.05, 1); // Lebih kecil
            const moboMat = new THREE.MeshStandardMaterial({ color: 0x004d40 });
            const motherboard = new THREE.Mesh(moboGeo, moboMat);
            // Posisikan mobo di atas meja, sedikit ke kanan dari tengah
            motherboard.position.set(rigBasePosition.x + 1.0, rigBasePosition.y + 0.05 / 2, rigBasePosition.z);
            scene.add(motherboard);
            models['motherboard'] = motherboard; // Simpan referensi

            // Buat komponen awal relatif terhadap posisi motherboard baru
            updateComponentModel3D('cpu', gameState.komponen.cpu.level);
            updateComponentModel3D('gpu', gameState.komponen.gpu.level);
            updateComponentModel3D('pendingin', gameState.komponen.pendingin.level);
        }

       /**
         * Menghapus & membuat ulang model 3D komponen rig pada posisi yang benar di atas meja.
         */
        function updateComponentModel3D(namaKomponen, levelBaru) {
            if (!models['motherboard']) return; // Jangan update jika motherboard belum ada

            // Hapus model lama
            if (models[namaKomponen]) {
                scene.remove(models[namaKomponen]);
                if (models[namaKomponen].geometry) models[namaKomponen].geometry.dispose();
                if (models[namaKomponen].material) { /* ... dispose material ... */
                    if (Array.isArray(models[namaKomponen].material)) {
                        models[namaKomponen].material.forEach(material => material.dispose());
                    } else {
                        models[namaKomponen].material.dispose();
                    }
                }
                delete models[namaKomponen];
            }

            let geometry, material, mesh;
            // Posisi dasar komponen adalah di atas motherboard
            const basePosition = models['motherboard'].position.clone();
            basePosition.y += 0.05 / 2; // Titik atas motherboard

            const scaleBase = 0.15; // Skala komponen dibuat lebih kecil agar muat di mobo kecil

            switch (namaKomponen) {
                case 'cpu':
                    const cpuSize = scaleBase * (1 + (levelBaru - 1) * 0.2);
                    geometry = new THREE.BoxGeometry(cpuSize, 0.1, cpuSize); // Lebih tipis
                    const cpuColors = [0x8d6e63, 0x795548, 0x5d4037];
                    material = new THREE.MeshStandardMaterial({ color: cpuColors[levelBaru - 1] || cpuColors[cpuColors.length-1] });
                    mesh = new THREE.Mesh(geometry, material);
                    // Posisikan CPU di tengah-depan motherboard
                    mesh.position.set(basePosition.x, basePosition.y + 0.1 / 2, basePosition.z + 0.2);
                    break;

                case 'gpu':
                    const gpuLength = 0.6 * (1 + (levelBaru - 1) * 0.3);
                    const gpuHeight = 0.2 * (1 + (levelBaru - 1) * 0.1); // Lebih tipis
                    geometry = new THREE.BoxGeometry(0.15, gpuHeight, gpuLength);
                    const gpuColors = [0x424242, 0x303030, 0x212121];
                    material = new THREE.MeshStandardMaterial({ color: gpuColors[levelBaru - 1] || gpuColors[gpuColors.length-1], roughness: 0.7 });
                    mesh = new THREE.Mesh(geometry, material);
                    mesh.rotation.y = Math.PI / 2;
                     // Posisikan GPU di belakang motherboard
                    mesh.position.set(basePosition.x, basePosition.y + gpuHeight/2, basePosition.z - 0.3);
                    break;

                case 'pendingin':
                     // Posisi pendingin harus di atas posisi CPU yang baru
                     if (models['cpu']) {
                        const cpuTopY = models['cpu'].position.y + 0.1 / 2;
                        let coolerHeight = 0;
                        if (levelBaru === 1) {
                            coolerHeight = 0.1;
                            geometry = new THREE.CylinderGeometry(scaleBase * 0.8, scaleBase * 0.8, coolerHeight, 12);
                            material = new THREE.MeshStandardMaterial({ color: 0xb0bec5 });
                        } else if (levelBaru === 2) {
                            coolerHeight = 0.3;
                            geometry = new THREE.BoxGeometry(scaleBase, coolerHeight, scaleBase * 0.8);
                            material = new THREE.MeshStandardMaterial({ color: 0x78909c });
                        } else {
                            coolerHeight = 0.5;
                            geometry = new THREE.BoxGeometry(scaleBase*1.2, coolerHeight, scaleBase);
                            material = new THREE.MeshStandardMaterial({ color: 0x546e7a });
                        }
                        mesh = new THREE.Mesh(geometry, material);
                        mesh.position.set(models['cpu'].position.x, cpuTopY + coolerHeight / 2, models['cpu'].position.z);
                     } else {
                        console.warn("CPU model not found, cannot place cooler.");
                        return; // Jangan buat cooler jika CPU tidak ada
                     }
                    break;
                default: return;
            }

            scene.add(mesh);
            models[namaKomponen] = mesh;
        }


        function animate() {
            requestAnimationFrame(animate);
            if (controls) controls.update();
            renderer.render(scene, camera);
        }

        /**
         * Menangani resize untuk layout landscape.
         */
        function onWindowResize() {
             const container = document.getElementById('canvas-container');
             if (!container || !camera || !renderer) return;

            // Ukuran container 3D (Panel Kiri)
            const width = container.clientWidth;
            const height = container.clientHeight;

            aspect = width / height;
            camera.left   = -frustumSize * aspect / 2;
            camera.right  =  frustumSize * aspect / 2;
            camera.top    =  frustumSize / 2;
            camera.bottom = -frustumSize / 2;
            camera.updateProjectionMatrix();
            renderer.setSize(width, height);
        }

        // ==========================================
        // EVENT LISTENERS
        // ==========================================
        function setupEventListeners() {
            // Tombol Upgrade
            document.getElementById('upgrade-cpu').addEventListener('click', () => upgradeComponent('cpu'));
            document.getElementById('upgrade-gpu').addEventListener('click', () => upgradeComponent('gpu'));
            document.getElementById('upgrade-pendingin').addEventListener('click', () => upgradeComponent('pendingin'));

            // Tombol Exchange
            document.getElementById('exchange-button').addEventListener('click', () => {
                // Tukar semua BTC yang tersedia
                exchangeBTC(gameState.minedBTC);
            });
        }

        // ==========================================
        // MULAI GAME
        // ==========================================
        document.addEventListener('DOMContentLoaded', init);

    </script>

</body>
</html>
